<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Hewlett Packard Enterprise" /><link rel="canonical" href="https://scod.hpedev.io/flexvolume_driver/hpe_3par_primera_installer/index.html" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <meta property="og:title" content="HPE Storage Container Orchestrator Documentation (SCOD)"/>
    <meta property="og:description" content="This is an umbrella documentation project for all container integrations surrounding HPE block, file and object storage. Tailored for IT ops, developers and technology partners."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://scod.hpedev.io"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://scod.hpedev.io/img/hpe-social-og-image01.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    
    <title>Index - SCOD.HPEDEV.IO</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/hpedev.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Index";
        var mkdocs_page_input_path = "flexvolume_driver/hpe_3par_primera_installer/index.md";
        var mkdocs_page_url = "/flexvolume_driver/hpe_3par_primera_installer/index.html";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-PC28RTKKTW"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', "G-PC28RTKKTW");
      </script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/hpe.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">WELCOME</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../welcome/index.html">Get started!</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">HPE CSI DRIVER FOR KUBERNETES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/deployment.html">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/using.html">Using</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Container Storage Providers</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/container_storage_provider/hpe_alletra_storage_mp_b10000/index.html">HPE Alletra Storage MP B10000, Alletra 9000, Primera and 3PAR</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/container_storage_provider/hpe_alletra_storage_mp_b10000_file_service/index.html">HPE Alletra Storage MP B10000 File Service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/container_storage_provider/hpe_alletra_6000/index.html">HPE Alletra 5000/6000 and Nimble Storage</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/metrics.html">Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/monitor.html">Pod Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/operations.html">Auxiliary Operations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../csi_driver/diagnostics.html">Diagnostics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Partner Ecosystems</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/hpe_morpheus/install.html">HPE Morpheus Kubernetes Service</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/hpe_ezmeral/install.html">HPE Ezmeral Runtime Enterprise</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/amazon_eks_anywhere/index.html">Amazon EKS Anywhere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/canonical/index.html">Canonical</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/cohesity/index.html">Cohesity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/commvault/index.html">Commvault</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/kasten/index.html">Veeam Kasten</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/mirantis/index.html">Mirantis</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/redhat_openshift/index.html">Red Hat OpenShift</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/suse_virtualization/index.html">SUSE Virtualization</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/suse_rancher/index.html">SUSE Rancher</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/tkgi/index.html">Tanzu TKGI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../csi_driver/partners/vmware/index.html">VMware</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">HPE COSI DRIVER FOR KUBERNETES</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cosi_driver/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cosi_driver/deployment.html">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cosi_driver/using.html">Using</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cosi_driver/diagnostics.html">Diagnostics</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">HPE GREENLAKE FOR FILE STORAGE</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../filex_csi_driver/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../filex_csi_driver/deployment.html">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../filex_csi_driver/using.html">Using</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEARN</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/persistent_storage/index.html">Persistent Storage for Kubernetes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/introduction_to_containers/index.html">For HPE partners:<br />&nbsp;&nbsp; Introduction to Containers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/csi_primitives/index.html">Introduction to CSI Primitives</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/video_gallery/index.html">Video Gallery</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../learn/csi_workshop/index.html">Interactive CSI Workshop</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">COMMUNITY</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://developer.hpe.com">HPE Developer</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://slack.hpedev.io">Sign up to HPE Developer on Slack</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/hpe-storage/scod/issues/new?title=I have some feedback on SCOD">Got feedback?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">EXTERNAL LINKS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://github.com/hpe-storage/scod">SCOD on GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/hpe-storage">HPE Storage on GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://hpe.com/storage/containers">Storage for Containers on hpe.com</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGAL</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../legal/contributing/index.html">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../legal/support/index.html">Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../legal/license/index.html">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../legal/notices/index.html">Notices</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">LEGACY DRIVERS AND PLUGINS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../legacy/index.html">Docker, FlexVolume and CSPs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SCOD.HPEDEV.IO</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Index</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="admonition error">
<p class="admonition-title">Expired content</p>
<p>The documentation described on this page may be obsolete and contain references to unsupported and deprecated software. Please reach out to your HPE representative if you think you need any of the components referenced within.</p>
</div>
<h1 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h1>
<p>The HPE 3PAR and Primera Volume Plug-in for Docker leverages Ansible to deploy the 3PAR/Primera driver for Kubernetes in order to provide scalable and persistent storage for stateful applications. </p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Using HPE 3PAR/Primera Storage with Kubernetes 1.15 and newer, please use the <a href="https://github.com/hpe-storage/csi-driver">HPE CSI Driver for Kubernetes</a>.</p>
</div>
<p>Source code is available in the <a href="https://github.com/hpe-storage/python-hpedockerplugin">hpe-storage/python-hpedockerplugin</a> GitHub repo.</p>
<div class="toc">
<ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#platform_requirements">Platform requirements</a><ul>
<li><a href="#hpe_3parprimera_storage_platform_requirements">HPE 3PAR/Primera Storage Platform Requirements</a></li>
</ul>
</li>
<li><a href="#deploying_to_kubernetes">Deploying to Kubernetes</a><ul>
<li><a href="#step_1_install_ansible">Step 1: Install Ansible</a><ul>
<li><a href="#ansible_connecting_to_remote_nodes">Ansible: Connecting to remote nodes</a></li>
<li><a href="#ansible_check_your_ssh_connections">Ansible: Check your SSH connections</a></li>
</ul>
</li>
<li><a href="#step_2_clone_the_github_repository">Step 2: Clone the Github repository</a></li>
<li><a href="#step_3_modify_the_ansible_hosts_file">Step 3: Modify the Ansible hosts file</a></li>
<li><a href="#step_4_create_the_properties_file">Step 4: Create the properties file</a><ul>
<li><a href="#file_persona_example_configuration">File Persona Example Configuration</a></li>
<li><a href="#multiple_backend_example_configuration">Multiple Backend Example Configuration</a></li>
</ul>
</li>
<li><a href="#step_5_run_the_ansible_playbook">Step 5: Run the Ansible playbook</a></li>
<li><a href="#step_6_verify_the_installation">Step 6: Verify the installation</a></li>
</ul>
</li>
<li><a href="#using">Using</a><ul>
<li><a href="#sample_storageclass">Sample StorageClass</a></li>
<li><a href="#test_and_verify_volume_provisioning">Test and verify volume provisioning</a></li>
<li><a href="#use_case_specific_examples">Use case specific examples</a><ul>
<li><a href="#snapshot_a_volume">Snapshot a volume</a></li>
<li><a href="#clone_a_volume">Clone a volume</a></li>
<li><a href="#replicate_a_containerized_volume">Replicate a containerized volume</a></li>
<li><a href="#import_cutover_a_volume">Import (cutover) a volume</a></li>
<li><a href="#using_overrides">Using overrides</a></li>
</ul>
</li>
<li><a href="#upgrade">Upgrade</a></li>
<li><a href="#uninstall">Uninstall</a></li>
</ul>
</li>
<li><a href="#storageclass_parameters">StorageClass parameters</a><ul>
<li><a href="#hpe_3parprimera_storage_storageclass_parameters">HPE 3PAR/Primera Storage StorageClass parameters</a><ul>
<li><a href="#common_parameters_for_provisioning_and_cloning">Common parameters for Provisioning and Cloning</a></li>
<li><a href="#cloningsnapshot_parameters">Cloning/Snapshot parameters</a></li>
<li><a href="#import_parameters">Import parameters</a></li>
<li><a href="#replication_support">Replication Support</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#diagnostics">Diagnostics</a><ul>
<li><a href="#troubleshooting_flexvolume_driver">Troubleshooting FlexVolume driver</a><ul>
<li><a href="#locations">Locations</a></li>
<li><a href="#connectivity">Connectivity</a></li>
<li><a href="#etcd">ETCD</a></li>
<li><a href="#hpe_3parprimera_flexvolume_and_dynamic_provisioner_driver_doryd_logs">HPE 3PAR/Primera FlexVolume and Dynamic Provisioner driver (doryd) logs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Refer to the <a href="https://spock.corp.int.hpe.com/spock/utility/document.aspx?docurl=Shared%20Documents/hw/3par/3par_volume_plugin_for_docker.pdf">SPOCK</a> page for the latest support matrix for HPE 3PAR and HPE Primera Volume Plug-in for Docker.</p>
<h2 id="platform_requirements">Platform requirements<a class="headerlink" href="#platform_requirements" title="Permanent link">&para;</a></h2>
<p>The HPE 3PAR/Primera FlexVolume driver supports multiple backends that are based on a "container provider" architecture.</p>
<h3 id="hpe_3parprimera_storage_platform_requirements">HPE 3PAR/Primera Storage Platform Requirements<a class="headerlink" href="#hpe_3parprimera_storage_platform_requirements" title="Permanent link">&para;</a></h3>
<p>Ensure that you have reviewed the <a href="https://github.com/hpe-storage/python-hpedockerplugin/blob/master/README.md">System Requirements</a>.</p>
<table>
<thead>
<tr>
<th>Driver</th>
<th>HPE 3PAR/Primera OS Version</th>
<th>Release Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>v3.3.1</td>
<td>3PAR OS: 3.3.1 MU5+<br>  Primera OS: 4.0+</td>
<td><a href="https://github.com/hpe-storage/python-hpedockerplugin/releases">v3.3.1</a></td>
</tr>
</tbody>
</table>
<ul>
<li>OpenShift Container Platform 3.9, 3.10 and 3.11.</li>
<li>Kubernetes 1.10 and above.</li>
<li>Redhat/CentOS 7.5+</li>
</ul>
<p><strong>Note:</strong> Refer to <a href="https://spock.corp.int.hpe.com/spock/utility/document.aspx?docurl=Shared%20Documents/hw/3par/3par_volume_plugin_for_docker.pdf">SPOCK</a> page for the latest support matrix for HPE 3PAR and HPE Primera Volume Plug-in for Docker.</p>
<h2 id="deploying_to_kubernetes">Deploying to Kubernetes<a class="headerlink" href="#deploying_to_kubernetes" title="Permanent link">&para;</a></h2>
<p>The recommended way to deploy and manage the HPE 3PAR and Primera Volume Plug-in for Kubernetes is to use Ansible.</p>
<p>Use the following steps to configure Ansible to perform the installation.</p>
<h3 id="step_1_install_ansible">Step 1: Install Ansible<a class="headerlink" href="#step_1_install_ansible" title="Permanent link">&para;</a></h3>
<p>Ensure that Ansible (v2.5 to v2.8) is installed. For more information, see <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Ansible Installation Guide</a>.</p>
<p><strong>NOTE:</strong> Ansible only needs to be installed on the machine that will be performing the deployment. Ansible does not need to be installed on your Kubernetes cluster.</p>
<p> <pre><code class=shell>$ pip install ansible
$ ansible --version
ansible 2.7.12
</code></pre></p>
<h5 id="ansible_connecting_to_remote_nodes">Ansible: Connecting to remote nodes<a class="headerlink" href="#ansible_connecting_to_remote_nodes" title="Permanent link">&para;</a></h5>
<p>Ansible communicates with remote machines over the SSH protocol. By default, Ansible uses native OpenSSH and connects to remote machines using your current user name, just as SSH does.</p>
<h5 id="ansible_check_your_ssh_connections">Ansible: Check your SSH connections<a class="headerlink" href="#ansible_check_your_ssh_connections" title="Permanent link">&para;</a></h5>
<p>Confirm that you can connect using SSH to all the nodes in your Kubernetes cluster using the same username. If necessary, add your public SSH key to the <code>authorized_keys</code> file on those systems.</p>
<h3 id="step_2_clone_the_github_repository">Step 2: Clone the Github repository<a class="headerlink" href="#step_2_clone_the_github_repository" title="Permanent link">&para;</a></h3>
<p> <pre><code class=shell>$ cd ~
$ git clone https://github.com/hpe-storage/python-hpedockerplugin
</code></pre></p>
<h3 id="step_3_modify_the_ansible_hosts_file">Step 3: Modify the Ansible hosts file<a class="headerlink" href="#step_3_modify_the_ansible_hosts_file" title="Permanent link">&para;</a></h3>
<p>Modify the <code>hosts</code> file to define the Kubernetes/OpenShift Master and Worker nodes. Also define where the HPE etcd cluster will be deployed, this can be done within the cluster or on external servers.</p>
<div class=md-fenced-code-tabs id=tab-tab-group-2><input name=tab-group-2 type=radio id=tab-group-2-0_shell checked=checked class=code-tab data-lang=shell aria-controls=tab-group-2-0_shell-panel role=tab><label for=tab-group-2-0_shell class=code-tab-label data-lang=shell id=tab-group-2-0_shell-label>Shell</label><div class=code-tabpanel role=tabpanel data-lang=shell id=tab-group-2-0_shell-panel aria-labelledby=tab-group-2-0_shell-label><pre><code class=shell>$ vi python-hpedockerplugin/ansible_3par_docker_plugin/hosts
</code></pre></div><input name=tab-group-2 type=radio id=tab-group-2-1_yaml class=code-tab data-lang=yaml aria-controls=tab-group-2-1_yaml-panel role=tab><label for=tab-group-2-1_yaml class=code-tab-label data-lang=yaml id=tab-group-2-1_yaml-label>Yaml</label><div class=code-tabpanel role=tabpanel data-lang=yaml id=tab-group-2-1_yaml-panel aria-labelledby=tab-group-2-1_yaml-label><pre><code class=yaml>[masters]
192.168.1.51

[workers]
192.168.1.52
192.168.1.53

[etcd]
192.168.1.51
192.168.1.52
192.168.1.53
</code></pre></div></div>
<h3 id="step_4_create_the_properties_file">Step 4: Create the properties file<a class="headerlink" href="#step_4_create_the_properties_file" title="Permanent link">&para;</a></h3>
<p>Create the <strong>properties/plugin_configuration_properties.yml</strong> based on your HPE 3PAR/Primera Storage array configuration.</p>
<p> <pre><code class=shell>$ vi python-hpedockerplugin/ansible_3par_docker_plugin/properties/plugin_configuration_properties.yml
</code></pre></p>
<p><strong>NOTE:</strong> Some of the properties are mandatory and must be specified in the properties file while others are optional.</p>
<p> <pre><code class=yaml>INVENTORY:
  DEFAULT:
#Mandatory Parameters--------------------------------------------------------------------------------

    # Specify the port to be used by HPE 3PAR plugin etcd cluster
    host_etcd_port_number: 23790
    # Plugin Driver - iSCSI
    hpedockerplugin_driver: hpedockerplugin.hpe.hpe_3par_iscsi.HPE3PARISCSIDriver
    hpe3par_ip: &lt;3par_array_IP&gt;
    hpe3par_username: &lt;3par_user&gt;
    hpe3par_password: &lt;3par_password&gt;
    #Specify the 3PAR port - 8080 default
    hpe3par_port: 8080
    hpe3par_cpg: &lt;cpg_name&gt;

    # Plugin version - Required only in DEFAULT backend
    volume_plugin: hpestorage/legacyvolumeplugin:3.3.1
    # Dory installer version - Required for Openshift/Kubernetes setup
    # Supported versions are dory_installer_v31, dory_installer_v32
    dory_installer_version: dory_installer_v32

#Optional Parameters--------------------------------------------------------------------------------

    logging: DEBUG
    hpe3par_snapcpg: FC_r6
    #hpe3par_iscsi_chap_enabled: True
    use_multipath: True
    #enforce_multipath: False
    #vlan_tag: True

</code></pre></p>
<p><strong>Available Properties Parameters</strong></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Mandatory</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>hpedockerplugin_driver</td>
<td>Yes</td>
<td>No default value</td>
<td>ISCSI/FC driver  (hpedockerplugin.hpe.hpe_3par_iscsi.HPE3PARISCSIDriver/hpedockerplugin.hpe.hpe_3par_fc.HPE3PARFCDriver)</td>
</tr>
<tr>
<td>hpe3par_ip</td>
<td>Yes</td>
<td>No default value</td>
<td>IP address of 3PAR array</td>
</tr>
<tr>
<td>hpe3par_username</td>
<td>Yes</td>
<td>No default value</td>
<td>3PAR username</td>
</tr>
<tr>
<td>hpe3par_password</td>
<td>Yes</td>
<td>No default value</td>
<td>3PAR password</td>
</tr>
<tr>
<td>hpe3par_port</td>
<td>Yes</td>
<td>8080</td>
<td>3PAR HTTP_PORT port</td>
</tr>
<tr>
<td>hpe3par_cpg</td>
<td>Yes</td>
<td>No default value</td>
<td>Primary user CPG</td>
</tr>
<tr>
<td>volume_plugin</td>
<td>Yes</td>
<td>No default value</td>
<td>Name of the docker volume image (only required with DEFAULT backend)</td>
</tr>
<tr>
<td>encryptor_key</td>
<td>No</td>
<td>No default value</td>
<td>Encryption key string for 3PAR password</td>
</tr>
<tr>
<td>logging</td>
<td>No</td>
<td>INFO</td>
<td>Log level</td>
</tr>
<tr>
<td>hpe3par_debug</td>
<td>No</td>
<td>No default value</td>
<td>3PAR log level</td>
</tr>
<tr>
<td>suppress_requests_ssl_warning</td>
<td>No</td>
<td>True</td>
<td>Suppress request SSL warnings</td>
</tr>
<tr>
<td>hpe3par_snapcpg</td>
<td>No</td>
<td>hpe3par_cpg</td>
<td>Snapshot CPG</td>
</tr>
<tr>
<td>hpe3par_iscsi_chap_enabled</td>
<td>No</td>
<td>False</td>
<td>ISCSI chap toggle</td>
</tr>
<tr>
<td>hpe3par_iscsi_ips</td>
<td>No</td>
<td>No default value</td>
<td>Comma separated iscsi port IPs (only required if driver is ISCSI based)</td>
</tr>
<tr>
<td>use_multipath</td>
<td>No</td>
<td>False</td>
<td>Mutltipath toggle</td>
</tr>
<tr>
<td>enforce_multipath</td>
<td>No</td>
<td>False</td>
<td>Forcefully enforce multipath</td>
</tr>
<tr>
<td>ssh_hosts_key_file</td>
<td>No</td>
<td>/root/.ssh/known_hosts</td>
<td>Path to hosts key file</td>
</tr>
<tr>
<td>quorum_witness_ip</td>
<td>No</td>
<td>No default value</td>
<td>Quorum witness IP</td>
</tr>
<tr>
<td>mount_prefix</td>
<td>No</td>
<td>No default value</td>
<td>Alternate mount path prefix</td>
</tr>
<tr>
<td>hpe3par_iscsi_ips</td>
<td>No</td>
<td>No default value</td>
<td>Comma separated iscsi IPs. If not provided, all iscsi IPs will be read from the array and populated in hpe.conf</td>
</tr>
<tr>
<td>vlan_tag</td>
<td>No</td>
<td>False</td>
<td>Populates the iscsi_ips which are vlan tagged, only applicable if hpe3par_iscsi_ips is not specified</td>
</tr>
<tr>
<td>replication_device</td>
<td>No</td>
<td>No default value</td>
<td>Replication backend properties</td>
</tr>
<tr>
<td>dory_installer_version</td>
<td>No</td>
<td>dory_installer_v32</td>
<td>Required for Openshift/Kubernetes setup. Dory installer version, supported versions are dory_installer_v31, dory_installer_v32</td>
</tr>
<tr>
<td>hpe3par_server_ip_pool</td>
<td>Yes</td>
<td>No default value</td>
<td>This parameter is specific to fileshare. It can be specified as a mix of range of IPs and individual IPs delimited by comma. Each range or individual IP must be followed by the corresponding subnet mask delimited by semi-colon E.g.: IP-Range:Subnet-Mask,Individual-IP:SubnetMask</td>
</tr>
<tr>
<td>hpe3par_default_fpg_size</td>
<td>No</td>
<td>No default value</td>
<td>This parameter is specific to fileshare. Default fpg size, It must be in the range 1TiB to 64TiB. If not specified here, it defaults to 16TiB</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Refer to <a href="#replication_support">Replication Support</a> for details on enabling Replication support.</p>
</div>
<h5 id="file_persona_example_configuration">File Persona Example Configuration<a class="headerlink" href="#file_persona_example_configuration" title="Permanent link">&para;</a></h5>
<p> <pre><code class=text>#Mandatory Parameters for Filepersona---------------------------------------------------------------
  DEFAULT_FILE:
    # Specify the port to be used by HPE 3PAR plugin etcd cluster
    host_etcd_port_number: 23790
    # Plugin Driver - File driver
    hpedockerplugin_driver: hpedockerplugin.hpe.hpe_3par_file.HPE3PARFileDriver
    hpe3par_ip: 192.168.2.50
    hpe3par_username: demo_user
    hpe3par_password: demo_pass
    hpe3par_cpg: demo_cpg
    hpe3par_port: 8080
    hpe3par_server_ip_pool: 192.168.98.3-192.168.98.10:255.255.192.0 
#Optional Parameters for Filepersona----------------------------------------------------------------
    hpe3par_default_fpg_size: 16
</code></pre></p>
<h5 id="multiple_backend_example_configuration">Multiple Backend Example Configuration<a class="headerlink" href="#multiple_backend_example_configuration" title="Permanent link">&para;</a></h5>
<p> <pre><code class=text>INVENTORY:
  DEFAULT:
#Mandatory Parameters-------------------------------------------------------------------------------

    # Specify the port to be used by HPE 3PAR plugin etcd cluster
    host_etcd_port_number: 23790
    # Plugin Driver - iSCSI
    hpedockerplugin_driver: hpedockerplugin.hpe.hpe_3par_iscsi.HPE3PARISCSIDriver
    hpe3par_ip: 192.168.1.50
    hpe3par_username: 3paradm
    hpe3par_password: 3pardata
    hpe3par_port: 8080
    hpe3par_cpg: FC_r6

    # Plugin version - Required only in DEFAULT backend
    volume_plugin: hpestorage/legacyvolumeplugin:3.3.1
    # Dory installer version - Required for Openshift/Kubernetes setup
    # Supported versions are dory_installer_v31, dory_installer_v32
    dory_installer_version: dory_installer_v32

#Optional Parameters--------------------------------------------------------------------------------

    #ssh_hosts_key_file: '/root/.ssh/known_hosts'
    logging: DEBUG
    #hpe3par_debug: True
    #suppress_requests_ssl_warning: True
    #hpe3par_snapcpg: FC_r6
    #hpe3par_iscsi_chap_enabled: True
    #use_multipath: False
    #enforce_multipath: False
    #vlan_tag: True

#Additional Backend (Optional)----------------------------------------------------------------------

  3PAR1:
#Mandatory Parameters-------------------------------------------------------------------------------

    # Specify the port to be used by HPE 3PAR plugin etcd cluster
    host_etcd_port_number: 23790
    # Plugin Driver - Fibre Channel
    hpedockerplugin_driver: hpedockerplugin.hpe.hpe_3par_fc.HPE3PARFCDriver
    hpe3par_ip: 192.168.2.50
    hpe3par_username: 3paradm
    hpe3par_password: 3pardata
    hpe3par_port: 8080
    hpe3par_cpg: FC_r6

#Optional Parameters--------------------------------------------------------------------------------

    #ssh_hosts_key_file: '/root/.ssh/known_hosts'
    logging: DEBUG
    #hpe3par_debug: True
    #suppress_requests_ssl_warning: True
    hpe3par_snapcpg: FC_r6
    #use_multipath: False
    #enforce_multipath: False
</code></pre></p>
<h3 id="step_5_run_the_ansible_playbook">Step 5: Run the Ansible playbook<a class="headerlink" href="#step_5_run_the_ansible_playbook" title="Permanent link">&para;</a></h3>
<p> <pre><code class=text>$ cd python-hpedockerplugin/ansible_3par_docker_plugin/
$ ansible-playbook -i hosts install_hpe_3par_volume_driver.yml
</code></pre></p>
<h3 id="step_6_verify_the_installation">Step 6: Verify the installation<a class="headerlink" href="#step_6_verify_the_installation" title="Permanent link">&para;</a></h3>
<ul>
<li>Once playbook has completed successfully, the PLAY RECAP should look like below</li>
</ul>
<p> <pre><code class=text>Installer should not show any failures and PLAY RECAP should look like below

PLAY RECAP ***********************************************************************
&lt;Master1-IP&gt;           : ok=85   changed=33   unreachable=0    failed=0
&lt;Master2-IP&gt;           : ok=76   changed=29   unreachable=0    failed=0
&lt;Master3-IP&gt;           : ok=76   changed=29   unreachable=0    failed=0
&lt;Worker1-IP&gt;           : ok=70   changed=27   unreachable=0    failed=0
&lt;Worker2-IP&gt;           : ok=70   changed=27   unreachable=0    failed=0
localhost              : ok=9    changed=3    unreachable=0    failed=0
</code></pre></p>
<ul>
<li>Verify plugin installation on all nodes.</li>
</ul>
<p> <pre><code class=text>$ docker ps | grep plugin; ssh &lt;Master2-IP&gt; &quot;docker ps | grep plugin&quot;;ssh &lt;Master3-IP&gt; &quot;docker ps | grep plugin&quot;;ssh &lt;Worker1-IP&gt; &quot;docker ps | grep plugin&quot;;ssh &lt;Worker2-IP&gt; &quot;docker ps | grep plugin&quot;
51b9d4b1d591        hpestorage/legacyvolumeplugin:3.3.1          &quot;/bin/sh -c ./plugin…&quot;   12 minutes ago      Up 12 minutes         plugin_container
a43f6d8f5080        hpestorage/legacyvolumeplugin:3.3.1          &quot;/bin/sh -c ./plugin…&quot;   12 minutes ago      Up 12 minutes         plugin_container
a88af9f46a0d        hpestorage/legacyvolumeplugin:3.3.1          &quot;/bin/sh -c ./plugin…&quot;   12 minutes ago      Up 12 minutes         plugin_container
5b20f16ab3af        hpestorage/legacyvolumeplugin:3.3.1          &quot;/bin/sh -c ./plugin…&quot;   12 minutes ago      Up 12 minutes         plugin_container
b0813a22cbd8        hpestorage/legacyvolumeplugin:3.3.1          &quot;/bin/sh -c ./plugin…&quot;   12 minutes ago      Up 12 minutes         plugin_container
</code></pre></p>
<ul>
<li>Verify the HPE FlexVolume driver Pod is running.</li>
</ul>
<p> <pre><code class=shell>kubectl get pods -n kube-system | grep doryd
NAME                                            READY   STATUS    RESTARTS   AGE
kube-storage-controller-doryd-7dd487b446-xr6q2  1/1     Running   0          45s
</code></pre></p>
<h2 id="using">Using<a class="headerlink" href="#using" title="Permanent link">&para;</a></h2>
<p>Get started using the FlexVolume driver by setting up <code>StorageClass</code>, <code>PVC</code> API objects. See <a href="#using">Using</a> for examples.</p>
<p>These instructions are provided as an example on how to use the HPE 3PAR/Primera Volume Plug-in with a HPE 3PAR/Primera Storage Array.</p>
<p>The below YAML declarations are meant to be created with <code>kubectl create</code>. Either copy the content to a file on the host where <code>kubectl</code> is being executed, or copy &amp; paste into the terminal, like this:</p>
<p> <pre><code class=shell>kubectl create -f-
&lt; paste the YAML &gt;
^D (CTRL + D)
</code></pre></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Some of the examples supported by the HPE 3PAR/Primera FlexVolume driver are available for <a href="https://github.com/hpe-storage/hpe3par-examples/tree/master/containers/kubernetes-openshift/samples">HPE 3PAR/Primera Storage</a> in the GitHub repo.</p>
</div>
<p>To get started, create a <code>StorageClass</code> API object referencing the <code>hpe-secret</code> and defining additional (optional) <code>StorageClass</code> parameters:</p>
<h3 id="sample_storageclass">Sample StorageClass<a class="headerlink" href="#sample_storageclass" title="Permanent link">&para;</a></h3>
<p>Sample storage classes can be found for <a href="https://github.com/hpe-storage/hpe3par-examples/blob/master/containers/kubernetes-openshift/samples/provisioning/sc-gold.yml">HPE 3PAR/Primera Storage</a>.</p>
<h3 id="test_and_verify_volume_provisioning">Test and verify volume provisioning<a class="headerlink" href="#test_and_verify_volume_provisioning" title="Permanent link">&para;</a></h3>
<p>Create a <code>StorageClass</code> with volume parameters as required. <strong>Change the CPG per your requirements.</strong></p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sc-gold
provisioner: hpe.com/hpe
parameters:
  provisioning: 'full'
  cpg: 'SSD_r6'
  fsOwner: '1001:1001'
</code></pre></p>
<p>Create a <code>PersistentVolumeClaim</code>. This makes sure a volume is created and provisioned on your behalf:</p>
<p> <pre><code class=yaml>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sc-gold-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 25Gi
  storageClassName: sc-gold
</code></pre></p>
<p>Check that a new <code>PersistentVolume</code> is created based on your claim:</p>
<p> <pre><code class=shell>$ kubectl get pv
NAME                                              CAPACITY     ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE
sc-gold-pvc-13336da3-7ca3-11e9-826c-00505692581f  25Gi         RWO            Delete           Bound    default/pvc-gold    sc-gold                 3s
</code></pre></p>
<p>The above output means that the FlexVolume driver successfully provisioned a new volume and bound to the requesting <code>PVC</code> to a new <code>PV</code>. The volume is not attached to any node yet. It will only be attached to a node if a workload is scheduled to a specific node. Now let us create a <code>Pod</code> that refers to the above volume. When the <code>Pod</code> is created, the volume will be attached, formatted and mounted to the specified container:</p>
<p> <pre><code class=yaml>kind: Pod
apiVersion: v1
metadata:
  name: pod-nginx
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
      name: &quot;http-server&quot;
    volumeMounts:
    - name: export
      mountPath: &quot;/usr/share/nginx/html&quot;
  volumes:
    - name: export
      persistentVolumeClaim:
        claimName: sc-gold-pvc
</code></pre></p>
<p>Check if the pod is running successfully:</p>
<p> <pre><code class=text>$ kubectl get pod pod-nginx
NAME          READY   STATUS    RESTARTS   AGE
pod-nginx     1/1     Running   0          2m29s
</code></pre></p>
<h3 id="use_case_specific_examples">Use case specific examples<a class="headerlink" href="#use_case_specific_examples" title="Permanent link">&para;</a></h3>
<p>This <code>StorageClass</code> examples help guide combinations of options when provisioning volumes.</p>
<h4 id="snapshot_a_volume">Snapshot a volume<a class="headerlink" href="#snapshot_a_volume" title="Permanent link">&para;</a></h4>
<p>This <code>StorageClass</code> will create a snapshot of a "production" volume.</p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sc-gold-snap-mongo
provisioner: hpe.com/hpe
parameters:
  virtualCopyOf: &quot;sc-mongo-10dc1195-779b-11e9-b787-0050569bb07c&quot;
</code></pre></p>
<h4 id="clone_a_volume">Clone a volume<a class="headerlink" href="#clone_a_volume" title="Permanent link">&para;</a></h4>
<p>This <code>StorageClass</code> will create clones of a "production" volume.</p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sc-gold-clone
provisioner: hpe.com/hpe
parameters:
  cloneOf: &quot;sc-gold-2a82c9e5-6213-11e9-8d53-0050569bb07c&quot;
</code></pre></p>
<h4 id="replicate_a_containerized_volume">Replicate a containerized volume<a class="headerlink" href="#replicate_a_containerized_volume" title="Permanent link">&para;</a></h4>
<p>This <code>StorageClass</code> will add a standard backend volume to a 3PAR Replication Group. If the replicationGroup specified does not exist, the plugin will create one. See <a href="#replication_support">Replication Support</a> for more details on configuring replication.</p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sc-mongodb-replicated
provisioner: hpe.com/hpe
parameters:
  provisioning: 'full'
  replicationGroup: 'mongodb-app1'
</code></pre></p>
<h4 id="import_cutover_a_volume">Import (cutover) a volume<a class="headerlink" href="#import_cutover_a_volume" title="Permanent link">&para;</a></h4>
<p>This <code>StorageClass</code> will import an existing 3PAR/Primera volume to Kubernetes. The source volume needs to be offline for the import to succeed.</p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: import-clone-legacy-prod
provisioner: hpe.com/hpe
parameters:
  importVol: &quot;production-db-vol&quot;
</code></pre></p>
<h4 id="using_overrides">Using overrides<a class="headerlink" href="#using_overrides" title="Permanent link">&para;</a></h4>
<p>The HPE Dynamic Provisioner for Kubernetes (doryd) understands a set of annotation keys a user can set on a <code>PVC</code>. If the corresponding keys exists in the list of the <code>allowOverrides</code> key in the <code>StorageClass</code>, the end-user can tweak certain aspects of the provisioning workflow. This opens up for very advanced data services.</p>
<p>StorageClass object:</p>
<p> <pre><code class=yaml>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sc-gold
provisioner: hpe.com/hpe
parameters:
  provisioning: 'full'
  cpg: 'SSD_r6'
  fsOwner: '1001:1001'
  allowOverrides: provisioning,compression,cpg,fsOwner
</code></pre></p>
<p>PersistentVolumeClaim object:</p>
<p> <pre><code class=yaml>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
 name: my-pvc
 annotations:
    hpe.com/provisioning: &quot;thin&quot;
    hpe.com/cpg: &quot;FC_r6&quot;
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 25Gi
  storageClassName: sc-gold
</code></pre></p>
<p>This will create a <code>PV</code> thinly provisioned using the <code>FC-r6</code> cpg.</p>
<h3 id="upgrade">Upgrade<a class="headerlink" href="#upgrade" title="Permanent link">&para;</a></h3>
<p>In order to upgrade the driver, simply modify the <code>ansible_3par_docker_plugin/properties/plugin_configuration_properties_sample.yml</code> used for the initial deployment and modify <code>hpestorage/legacyvolumeplugin</code> to the latest image from docker hub.</p>
<p>For example:</p>
<p> <pre><code class=text>    volume_plugin: hpestorage/legacyvolumeplugin:3.3

    Change to:
    volume_plugin: hpestorage/legacyvolumeplugin:3.3.1
</code></pre></p>
<p>Re-run the installer.</p>
<p> <pre><code class=shell>$ ansible-playbook -i hosts install_hpe_3par_volume_driver.yml
</code></pre></p>
<h3 id="uninstall">Uninstall<a class="headerlink" href="#uninstall" title="Permanent link">&para;</a></h3>
<p>Run the following to uninstall the FlexVolume driver from the cluster.</p>
<p> <pre><code class>$ cd ~
$ cd python-hpedockerplugin/ansible_3par_docker_plugin
$ ansible-playbook -i hosts uninstall/uninstall_hpe_3par_volume_driver.yml
</code></pre></p>
<h2 id="storageclass_parameters">StorageClass parameters<a class="headerlink" href="#storageclass_parameters" title="Permanent link">&para;</a></h2>
<p>This section highlights all the available <code>StorageClass</code> parameters that are supported.</p>
<h3 id="hpe_3parprimera_storage_storageclass_parameters">HPE 3PAR/Primera Storage StorageClass parameters<a class="headerlink" href="#hpe_3parprimera_storage_storageclass_parameters" title="Permanent link">&para;</a></h3>
<p>A <code>StorageClass</code> is used to provision or clone an HPE 3PAR\Primera Storage-backed persistent volume. It can also be used to import an existing HPE 3PAR/Primera Storage volume or clone of a snapshot into the Kubernetes cluster. The parameters are grouped below by those same workflows.</p>
<p>A sample <a href="https://raw.githubusercontent.com/hpe-storage/hpe3par-examples/master/containers/kubernetes-openshift/samples/provisioning/sc-gold.yml">StorageClass</a> is provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are optional parameters.</p>
</div>
<h4 id="common_parameters_for_provisioning_and_cloning">Common parameters for Provisioning and Cloning<a class="headerlink" href="#common_parameters_for_provisioning_and_cloning" title="Permanent link">&para;</a></h4>
<p>These parameters are mutable betweeen a parent volume and creating a clone from a snapshot.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Options</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>Integer</td>
<td>-</td>
<td>size: "10"</td>
</tr>
<tr>
<td>provisioning</td>
<td></td>
<td>thin, full, dedupe</td>
<td>provisioning: "thin"</td>
</tr>
<tr>
<td>flash-cache</td>
<td>Text</td>
<td>true, false</td>
<td>flash-cache: "true"</td>
</tr>
<tr>
<td>compression</td>
<td>boolean</td>
<td>true, false</td>
<td>compression: "true"</td>
</tr>
<tr>
<td>MountConflictDelay</td>
<td>Integer</td>
<td>-</td>
<td>MountConflictDelay: "30"</td>
</tr>
<tr>
<td>qos-name</td>
<td>Text</td>
<td>vvset name</td>
<td>qos-name: "<vvset_name>"</td>
</tr>
<tr>
<td>replicationGroup</td>
<td>Text</td>
<td>3PAR RCG name</td>
<td>replicationGroup: "Test-RCG"</td>
</tr>
<tr>
<td>fsOwner</td>
<td>userId:groupId</td>
<td>The user id and group id that should own the root directory of the filesystem.</td>
<td></td>
</tr>
<tr>
<td>fsMode</td>
<td>Octal digits</td>
<td>1 to 4 octal digits that represent the file mode to be applied to the root directory of the filesystem.</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="cloningsnapshot_parameters">Cloning/Snapshot parameters<a class="headerlink" href="#cloningsnapshot_parameters" title="Permanent link">&para;</a></h4>
<p>Either use <code>cloneOf</code> and reference a PVC in the current namespace or use <code>virtualCopyOf</code> and reference a 3PAR/Primera volume name to snapshot/clone and import into Kubernetes.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Options</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>cloneOf</td>
<td>Text</td>
<td>volume name</td>
<td>cloneOf: "&lt;volume_name&gt;"</td>
</tr>
<tr>
<td>virtualCopyOf</td>
<td>Text</td>
<td>volume name</td>
<td>virtualCopyOf: "&lt;volume_name&gt;"</td>
</tr>
<tr>
<td>expirationHours</td>
<td>Integer</td>
<td>option of virtualCopyOf</td>
<td>expirationHours: "10"</td>
</tr>
<tr>
<td>retentionHours</td>
<td>Integer</td>
<td>option of virtualCopyOf</td>
<td>retentionHours: "10"</td>
</tr>
</tbody>
</table>
<h4 id="import_parameters">Import parameters<a class="headerlink" href="#import_parameters" title="Permanent link">&para;</a></h4>
<p>Importing volumes to Kubernetes requires the source 3PAR/Primera volume to be offline. </p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>importVol</td>
<td>Text</td>
<td>volume name</td>
<td>importVol: "&lt;volume_name&gt;"</td>
</tr>
</tbody>
</table>
<h4 id="replication_support">Replication Support<a class="headerlink" href="#replication_support" title="Permanent link">&para;</a></h4>
<p>The HPE 3PAR/Primer FlexVolume driver supports array based synchronous and asynchronous replication. In order to enable replication within the FlexVolume driver, the arrays need to be properly zoned, visible to the Kubernetes cluster, and replication configured. For Peer Persistence, a quorum witness will need to be configured. </p>
<p>Once the replication is enabled at the array level, the FlexVolume driver will need to be configured. </p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Replication support can be enabled during initial deployment through the plugin configuration file. In order to enable replication support post deployment, modify the <strong>plugin_configuration_properties.yml</strong> used for deployment, add the replication parameter section below, and re-run the Ansible installer.</p>
</div>
<p>Edit the <strong>plugin_configuration_properties.yml</strong> file and edit the Optional Replication Section.</p>
<p> <pre><code class=text>INVENTORY:
  DEFAULT:
#Mandatory Parameters-------------------------------------------------------------------------------

    # Specify the port to be used by HPE 3PAR plugin etcd cluster
    host_etcd_port_number: 23790
    # Plugin Driver - iSCSI
    hpedockerplugin_driver: hpedockerplugin.hpe.hpe_3par_iscsi.HPE3PARISCSIDriver
    hpe3par_ip: &lt;local_3par_ip&gt;
    hpe3par_username: &lt;local_3par_user&gt;
    hpe3par_password: &lt;local_3par_password&gt;
    hpe3par_port: 8080
    hpe3par_cpg: FC_r6

    # Plugin version - Required only in DEFAULT backend
    volume_plugin: hpestorage/legacyvolumeplugin:3.3.1
    # Dory installer version - Required for Openshift/Kubernetes setup
    dory_installer_version: dory_installer_v32

#Optional Parameters--------------------------------------------------------------------------------

    logging: DEBUG
    hpe3par_snapcpg: FC_r6
    use_multipath: False
    enforce_multipath: False

#Optional Replication Parameters--------------------------------------------------------------------
    replication_device:
      backend_id: remote_3PAR
      #Quorum Witness required for Peer Persistence only
      #quorum_witness_ip: &lt;quorum_witness_ip&gt;
      replication_mode: synchronous
      cpg_map: &quot;local_CPG:remote_CPG&quot;
      snap_cpg_map: &quot;local_copy_CPG:remote_copy_CPG&quot;
      hpe3par_ip: &lt;remote_3par_ip&gt;
      hpe3par_username: &lt;remote_3par_user&gt;
      hpe3par_password: &lt;remote_3par_password&gt;
      hpe3par_port: 8080
      #vlan_tag: False
</code></pre></p>
<p>Once the properties file is configured, you can proceed with the <a href="#step_5_run_the_ansible_playbook">standard installation steps</a>. </p>
<h2 id="diagnostics">Diagnostics<a class="headerlink" href="#diagnostics" title="Permanent link">&para;</a></h2>
<p>This section outlines a few troubleshooting steps for the HPE 3PAR/Primera FlexVolume driver. This product is supported by HPE, please consult with your support organization prior attempting any configuration changes.</p>
<h3 id="troubleshooting_flexvolume_driver">Troubleshooting FlexVolume driver<a class="headerlink" href="#troubleshooting_flexvolume_driver" title="Permanent link">&para;</a></h3>
<p>The FlexVolume driver is a binary executed by the kubelet to perform mount/unmount/attach/detach operations as workloads request storage resources. The binary relies on communicating with a socket on the host where the volume plugin responsible for the MUAD operations perform control-plane or data-plane operations against the backend system hosting the actual volumes.</p>
<h4 id="locations">Locations<a class="headerlink" href="#locations" title="Permanent link">&para;</a></h4>
<p>The driver has a configuration file where certain defaults can be tweaked to accommodate a certain behavior. Under normal circumstances, this file does not need any tweaking.</p>
<p>The name and the location of the binary varies based on Kubernetes distribution (the default 'exec' path) and what backend driver is being used. In a typical scenario, using 3PAR/Primera, this is expected:</p>
<ul>
<li>Binary: <code>/usr/libexec/kubernetes/kubelet-plugins/volume/exec/hpe.com~hpe/hpe</code></li>
<li>Config file: <code>/etc/hpedockerplugin/hpe.conf</code></li>
</ul>
<h4 id="connectivity">Connectivity<a class="headerlink" href="#connectivity" title="Permanent link">&para;</a></h4>
<p>To verify the FlexVolume binary can actually communicate with the backend volume plugin, issue a faux mount request:</p>
<p> <pre><code class>/usr/libexec/kubernetes/kubelet-plugins/volume/exec/hpe.com~hpe/hpe mount no/op '{&quot;name&quot;:&quot;myvol1&quot;}'
</code></pre></p>
<p>If the FlexVolume driver can successfully communicate with the volume plugin socket:</p>
<p> <pre><code class=json>{&quot;status&quot;:&quot;Failure&quot;,&quot;message&quot;:&quot;configured to NOT create volumes&quot;}
</code></pre></p>
<p>In the case of any other output, check if the backend volume plugin is alive:</p>
<p> <pre><code class=shell>$ docker volume create -d hpe -o help=backends
</code></pre></p>
<p>It should output:</p>
<p> <pre><code class=shell>=================================
NAME                     STATUS
=================================
DEFAULT                   OK
</code></pre></p>
<h4 id="etcd">ETCD<a class="headerlink" href="#etcd" title="Permanent link">&para;</a></h4>
<p>To verify the etcd members on nodes.</p>
<p> <pre><code class=shell>$ /usr/bin/etcdctl --endpoints http://&lt;Master1-IP&gt;:23790 member list 
</code></pre></p>
<p>It should output:</p>
<p> <pre><code class=shell>b70ca254f54dd23: name=&lt;Worker2-IP&gt; peerURLs=http://&lt;Worker2-IP&gt;:23800 clientURLs=http://&lt;Worker2-IP&gt;:23790 isLeader=true
236bf7d5cc7a32d4: name=&lt;Worker1-IP&gt; peerURLs=http://&lt;Worker1-IP&gt;:23800 clientURLs=http://&lt;Worker1-IP&gt;:23790 isLeader=false
445e80419ae8729b: name=&lt;Master1-IP&gt; peerURLs=http://&lt;Master1-IP&gt;:23800 clientURLs=http://&lt;Master1-IP&gt;:23790 isLeader=false
e340a5833e93861e: name=&lt;Master3-IP&gt; peerURLs=http://&lt;Master3-IP&gt;:23800 clientURLs=http://&lt;Master3-IP&gt;:23790 isLeader=false
f5b5599d719d376e: name=&lt;Master2-IP&gt; peerURLs=http://&lt;Master2-IP&gt;:23800 clientURLs=http://&lt;Master2-IP&gt;:23790 isLeader=false
</code></pre></p>
<h4 id="hpe_3parprimera_flexvolume_and_dynamic_provisioner_driver_doryd_logs">HPE 3PAR/Primera FlexVolume and Dynamic Provisioner driver (doryd) logs<a class="headerlink" href="#hpe_3parprimera_flexvolume_and_dynamic_provisioner_driver_doryd_logs" title="Permanent link">&para;</a></h4>
<p>Log files associated with the HPE 3PAR/Primera FlexVolume driver logs data to the standard output stream. If the logs need to be retained for long term, use a standard logging solution. Some of the logs on the host are persisted which follow standard logrotate policies.</p>
<p>HPE 3PAR/Primera FlexVolume logs: (per node)</p>
<p> <pre><code class=shell>$ docker logs -f plugin_container
</code></pre></p>
<p>Dynamic Provisioner logs:</p>
<p> <pre><code class=shell>kubectl logs -f kube-storage-controller-doryd -n kube-system
</code></pre></p>
<p>The logs are persisted at <code>/var/log/hpe-dynamic-provisioner.log</code></p>
              
            </div>
          </div>

<footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2020-2025 Hewlett Packard Enterprise Development LP<br />Give <a href="https://github.com/hpe-storage/scod/issues/new?title=flexvolume_driver/hpe_3par_primera_installer/index.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/hpe-storage/scod" class="fa fa-code-fork" style="color: #fcfcfc"> hpe-storage/scod</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
